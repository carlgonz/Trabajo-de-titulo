\chapter{Diseño del software}

\section{Resumen}

En este capítulo se describe el proceso de diseño del software de control para el satélite. El proceso de diseño considera en primera instancia los requerimientos funcionales de la misión así, requerimientos generales de desarrollo, así como la plataforma de hardware sobre la que se debe diseñar para tener claro las limitaciones y alcances del diseño final.

El diseño del la aplicación se detalla en diferentes niveles, incluyendo una visión global en base a módulo y se centra en específico en la aplicación de un determinado patrón de diseño que guía la solución propuesta en forma de una arquitectura basada en \textit{command patern}

Para el diseño de la arquitectura se ha utilizado un patrón de diseño llamado \textit{command pattern} el cual se programa en lenguaje C para el compilador Microchip MPLAB C30 V3.3x utilizando el sistema operativo FreeRTOS. Todo esto sobre una plataforma de desarrollo CubesatKit que cuenta con un procesador PIC24FJ256GA110.

\section{Requerimientos}
\subsection{Requerimientos generales}
\subsection{Requerimientos operacionales}
Los requerimientos operacionales se refieren a las funcionalidades que se espera que el computador a bordo del bus SUCHAI deba realizar. Estos requerimientos son los requisitos básicos que el sistema debe cumplir para considerar que se cuenta con un satélite capaz de llevar a cabo la misión del proyecto SUCHAI y son clasificados según el área de la misión que se ve afectada.

La lista de requerimientos proviene de una serie de reuniones sostenidas con los integrantes de los diferentes grupos de trabajo según los lineamientos del jefe de proyecto.

\subsubsection{Área de comunicaciones}
\paragraph{Configuración inicial del \textit{transcevier}.}
El satélite debe ser capaz de fijar las configuraciones iniciales del sistema de comunicaciones como encender el \textit{transcevier}, silenciar las comunicaciones durante determinado tiempo inmediatamente después del lanzamiento, configurar la frecuencia de transmisión a la frecuencia asignada por la IARU y la potencia, configurar y encender beacon, entre otros.

El sistema debe almacenar de manera permanente estas configuraciones iniciales, para reconfigurar el \textit{transcevier} en caso de reinicio o falla así como permitir una reconfiguración de parámetros durante el desarrollo de la misión.

\paragraph{Despliegue de antenas.}
El satélite, luego de transcurrido el tiempo de silencio radial obligatorio, debe desplegar las antenas de comunicaciones con la estación terrena. Esto se realiza mediante la activación de algún sistema eléctrico, que cuenta con cierto sistema de retroalimentación para comprobar que las antenas fueron efectivamente desplegadas. Esta operación puede requerir sucesivos intentos, hasta que las antenas sean desplegadas.

\paragraph{Procesamiento de telecomandos.}
El sistema de comunicaciones debe ser capaz de recibir telecomandos desde la estación terrena y el software de control deberá recogerlos y ejecutar las acciones requeridas. Esto incluye la definición de un formato de telecomandos; la capacidad del sistema de analizar los comandos y sus argumentos dentro de un paquete de comunicaciones; y la posterior ejecución del comando recibido.

\paragraph{Protocolo de enlace.}
El satélite debe ser capaz de recibir y enviar datos a la estación terrena, para esto se requiere en primer lugar, que el satélite se pueda rastrear para lo cual se debe emitir una señal de baliza o \textit{beacon}; segundo, el satélite debe escuchar la estación terrena para determinar si se recibirán ordenes o se descargará información; y tercero, establecer un protocolo de enlace que permita realizar las operaciones de descarga y subida de datos.

\paragraph{Envío de telemetría.}
El satélite recolectará los datos requeridos por la misión, que incluyen información general sobre el estado del vehículo espacial y sus subsistemas así como los datos generados por \textit{payloads} abordo. El envío de telemetría puede ser automático cada vez que el satélite se enlace con la estación terrena o bajo demanda a través de telecomandos que indiquen el tipo de información que es requerida.

\subsubsection{Control central}
\paragraph{Organizar telemetría.}
Durante la misión se generarán datos que provienen de diferentes subsistemas o \textit{payloads}. Se debe contar con un medio de almacenamiento con la capacidad adecuada para mantener estos datos y un sistema de organización de los diferentes datos guardados con el objetivo de ser requeridos de manera selectiva para ser enviados como telemetría a la estación terrena.

\paragraph{Plan de vuelo.}
El satélite debe ser capaz de recibir y ejecutar un plan de vuelo consistente en una serie de acciones a ejecutar en momentos determinados de tiempo. El plan de vuelo puede ser precargado en el satélite antes de ser lanzado así como ser actualizado mediante telecomandos. Esto provee flexibilidad en las tareas que se ejecutarán durante la misión, permitiendo controlar el uso de los diferentes recursos del satélite.

\paragraph{Obtener el estado del sistema.}
De manera autónoma el software de control debe recolectar información básica sobre el estado del sistema en general. Esta información será usada para determinar la salud del sistema y tomar las acciones necesarias en vuelo o bien será descargada como telemetría para ser posteriormente analizada. Ejemplos de variables asociadas al estado del sistema son el nivel de carga de las baterías, la hora del sistema, el estado del sistema de comunicaciones, el estado del sistema de control, entre otras.

\paragraph{Tolerancia a fallos de software.}
SURE?
El sistema debe ser capaz de recuperarse ante fallas del software de control, reinicios o módulos de software funcionando de manera incorrecta. Por ejemplo, debe evitar la ejecución de acciones que han causado fallas sucesivas veces o no activar módulos que han fallado anteriormente.

\paragraph{Inicialización del sistema.}
El software control debe poseer un algoritmo de inicio del sistema en general, que considera la inicialización del software con los parámetros adecuados a un estado adecuado, la inicialización de otros módulos o subsistemas así como las obligaciones de silencio radial durante el lanzamiento, despliegue de antenas, etc.

El software de control debe tener la capacidad de reiniciarse de manera segura y considerando variables fundamentales del estado anterior al reinicio.

\subsubsection{Área de energía}
\paragraph{Estimación de la carga de la batería.}
El software de control debe considerar un método de estimación de la carga de las baterías del satélite. Esta información debe estar a disposición como una variable del sistema para ser utilizado por el sistema de control de energía utilizada por el satélite.

\paragraph{Presupuesto de energía.}
Se debe considerar la cantidad de energía disponible en el satélite para ejecutar las acciones requeridas. Asimismo se debe tener claro el presupuesto energético de cada acción que se realiza en el satélite. El software de control debe plantear una estrategia para evitar que se ejecuten acciones que estén fuera del presupuesto energético disponible así como una manera de planificar el consumo energético de la misión.

\subsubsection{Órbita}
\paragraph{Actualizar parámetros de órbita.}
Se debe contar con una estrategia de estimación y actualización de los parámetros de órbita del satélite con el objetivo de contar con la información necesaria para la ejecución de acciones dependientes de la posición real de satélite. Ejemplos de este tipo de acciones son la ejecución de un experimento en algún \textit{payload} o en enlace con una estación terrena para descargar datos de telemetría.

\subsubsection{\textit{Payloads}}
\paragraph{Ejecución de comandos de \textit{payloads}}.
El sistema de control debe tener la capacidad de controlar diferentes subsistemas asociados a \textit{payloads} del satélite. Se debe considerar que los \textit{payloads} abordo del satélite pueden variar de misión en misión e incluso pueden ser descartados o agregados en etapas tardías del proyecto. Por eso el sistema de control debe ser flexible en la capacidad de agregar o eliminar módulos que se relacionen con el control de \textit{payloads} sin afectar al resto de los sistemas.

\subsubsection{Tolerancia a fallos}
\paragraph{Estado de salud del sistema.}
\paragraph{Mucho tiempo sin conexión a tierra.}
\paragraph{Problemas al desplegar la antena.}
\paragraph{\textit{Watchdog}.}
\paragraph{Fallos de hardware.}

\subsection{Requerimientos mínimos}

\subsection{Requerimientos no funcionales}
Por requerimientos no funcionales se entienden aquellos atributos asociados a la calidad del software o criterios que permiten determinar cómo debería ser el software que se está diseñando. A diferencia del los requerimientos funcionales que explican lo que el software debería hacer, los requerimientos no funcionales explican las cualidades y restricciones que guiarán el proceso de diseño.

Los siguientes aspectos relacionados con la calidad del software y basados en el estándar ISO 25010\cite{ISO25010}, fueron tomados en consideración para evaluar su importancia en el diseño de la arquitectura del software de control.

\begin{itemize}
	\item \textbf{Rendimiento.}  Se refiere a la eficiencia del código implementado, la velocidad de ejecución, el uso de recursos de hardware y memoria del satélite.
	\item \textbf{Escalable.} 
	\item Modificable
	\item Seguridad
	\item Confiable
\end{itemize}
%Explicar en cada punto y agregar una tabla con la importancia de cada tema

\section{Plataforma}
Se describe la plataforma final donde se ejecutará la aplicación, en este caso un sistema embebido consistente de un PIC24FJ256GA110

\section{Arquitectura de software}
\subsection{Arquitectura Global}
\subsection{Controladores de hardware}
\subsection{Sistema operativo}
\subsection{Aplicación}